<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/GraphActivity/index.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/GraphActivity/index.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as d3 from "d3";
import { useEffect } from "react";

/**
 * Component to render the activity graph
 * @param {Object} data - Object with data to be displayed in the graph about activity (kg/calories/day)
 * @param {int} durationAnimation - Duration of the animation in milliseconds
 * @returns {JSX.Element} - Graph with the activity data
 */
function GraphActivity({ data, durationAnimation }) {
   useEffect(() => {
      // Constants to define the size of the graph
      // and some params

      const width = 840;
      const height = 320;
      const margin = { top: 80, right: 70, bottom: 50, left: 50 };

      const innerWidth = width - margin.left - margin.right;
      const innerHeight = height - margin.top - margin.bottom;

      const svg = d3.select(".graph-activity");
      svg.attr("width", width).attr("height", height);

      // X and Y scales for calories and kg
      const xScale = d3.scaleLinear().domain([1, 7]).range([0, innerWidth]);

      const yScaleKg = d3
         .scaleLinear()
         .domain([
            d3.min(data, (d) => d.kilogram - 1),
            d3.max(data, (d) => d.kilogram + 1),
         ])
         .range([innerHeight, 0]);
      const yScaleCalories = d3
         .scaleLinear()
         .domain([0, 600])
         .range([innerHeight, 0]);

      //axis
      const xAxis = d3.axisBottom(xScale).ticks(7).tickSizeOuter(0);
      const yAxis = d3
         .axisRight(yScaleKg)
         .ticks(3)
         .tickSizeInner(-innerWidth)
         .tickSizeOuter(0);

      //some group to contains the graphs
      const groupDataCalories = svg
         .append("g")
         .attr("transform", `translate(${margin.left + 13},${margin.top})`);
      const groupDataKg = svg
         .append("g")
         .attr("transform", `translate(${margin.left},${margin.top})`);

      //Add Y axis and remove useless tthings
      const yAxisSelector = groupDataCalories
         .append("g")
         .attr("transform", `translate(${innerWidth + 15},0)`);

      yAxisSelector.call(yAxis);
      yAxisSelector.selectAll(".tick text").classed("tick-text", true);
      yAxisSelector.selectAll(".tick line").classed("tick-line", true);

      yAxisSelector.selectAll(".domain").remove();

      //Draw kg
      groupDataKg
         .selectAll("rect")
         .data(data)
         .enter()
         .append("rect")
         .attr("x", (d, i) => xScale(i + 1))
         .attr("y", innerHeight)
         .attr("width", 7)
         .attr("height", 0)
         .classed("bar-kg", true)
         .attr("rx", 2)
         .attr("ry", 2)
         .transition()
         .delay((d, i) => (i * durationAnimation) / 20)
         .duration(durationAnimation)
         .attr("y", (d) => yScaleKg(d.kilogram))
         .attr("height", (d) => innerHeight - yScaleKg(d.kilogram));

      //Add X axis and remove useless tthings
      const xAxisSelector = groupDataKg
         .append("g")
         .attr("transform", `translate(10,${innerHeight})`);
      xAxisSelector.call(xAxis);

      xAxisSelector.selectAll(".tick line").remove();
      xAxisSelector.selectAll(".tick text").classed("tick-text", true);

      //draw calories
      groupDataCalories
         .selectAll("rect")
         .data(data)
         .enter()
         .append("rect")
         .attr("x", (d, i) => xScale(i + 1))
         .attr("y", innerHeight)
         .attr("width", 7)
         .attr("height", 0)
         .classed("bar-calorie", true)
         .attr("rx", 2)
         .attr("ry", 2)
         .transition()
         .delay((d, i) => (i * durationAnimation) / 20)
         .duration(durationAnimation)
         .attr("y", (d) => yScaleCalories(d.calories))
         .attr("height", (d) => innerHeight - yScaleCalories(d.calories));

      //Add title
      const title = svg
         .append("g")
         .classed("title", true)
         .attr("transform", `translate(${margin.left},${margin.top - 50})`);
      title.append("text").text("Activité quotidienne");

      //Add legend labels
      const legend = svg
         .append("g")
         .classed("legend", true)
         .attr(
            "transform",
            `translate(${innerWidth - margin.right - 100},${margin.top - 50})`
         );
      legend
         .append("circle")
         .attr("x", 0)
         .attr("y", 0)
         .attr("r", 4)
         .classed("legend-circle-kg", true);

      legend
         .append("text")
         .text("Poids (kg)")
         .attr("x", 10)
         .attr("y", 5)
         .classed("legend-text-kg", true);

      legend
         .append("circle")
         .attr("x", 0)
         .attr("y", 0)
         .attr("r", 4)
         .attr("transform", `translate(96,0)`)
         .classed("legend-circle-calorie", true);
      legend
         .append("text")
         .text("Calories brûlées (kCal)")
         .attr("x", 10)
         .attr("y", 5)
         .classed("legend-text-calorie", true)
         .attr("transform", `translate(96,0)`);

      //set the groupe rect
      const widthHoverSelector =
         parseInt(xScale.range()[1] / xScale.domain()[1]) + 22;
      const groupHoverSelector = svg.append("g");
      const tooltip = groupHoverSelector.append("g");
      for (let i = 0; i &lt; xScale.domain()[1]; i++) {
         groupHoverSelector
            .append("rect")
            .classed("hover-selector", true)
            .attr("hover-selector", i)
            .attr("x", i * widthHoverSelector)
            .attr("y", 0 + margin.top)
            .attr("width", widthHoverSelector)
            .attr("height", innerHeight)

            .on("mouseenter", function (event, d) {
               d3.select(this)
                  .transition()
                  .duration(100)
                  .style("opacity", "0.2"); // &lt;== CSS selector (DOM)

               tooltip.attr(
                  "transform",
                  `translate(${
                     i === xScale.domain()[1] - 1
                        ? -70 - +widthHoverSelector
                        : 0
                  }, 30)`
               );
               tooltip
                  .append("rect")
                  .classed("tooltip-rect", true)
                  .attr("x", i * widthHoverSelector + widthHoverSelector + 10)
                  .attr("y", margin.top / 3 - 10)
                  .attr("width", 40)
                  .attr("height", 55);

               tooltip
                  .append("text")
                  .text(`${data[i].kilogram} kg`)
                  .classed("tooltip-text", true)
                  .attr("x", i * widthHoverSelector + widthHoverSelector + 20)
                  .attr("y", margin.top / 3 + 10);
               tooltip
                  .append("text")
                  .text(`${data[i].calories} kCal`)
                  .classed("tooltip-text", true)
                  .attr("x", i * widthHoverSelector + widthHoverSelector + 15)
                  .attr("y", margin.top / 3 + 30);
            })
            .on("mouseleave ", function (event, d) {
               d3.select(this).transition().duration(100).style("opacity", "0"); // &lt;== CSS selector (DOM)

               //remove tooltip
               tooltip.selectAll(".tooltip-rect, .tooltip-text").remove();
            });
      }
   }, [data, durationAnimation]);

   return (
      &lt;div className="home__stats--card gray-card large">
         &lt;svg className="graph-activity">&lt;/svg>
      &lt;/div>
   );
}

export default GraphActivity;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Activity.html">Activity</a></li><li><a href="API.html">API</a></li><li><a href="AverageSessions.html">AverageSessions</a></li><li><a href="Home.html">Home</a></li><li><a href="Performance.html">Performance</a></li><li><a href="User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#GraphActivity">GraphActivity</a></li><li><a href="global.html#GraphAverageSessions">GraphAverageSessions</a></li><li><a href="global.html#GraphPerformance">GraphPerformance</a></li><li><a href="global.html#GraphUserScore">GraphUserScore</a></li><li><a href="global.html#NavBarFooter">NavBarFooter</a></li><li><a href="global.html#NavBarMenu">NavBarMenu</a></li><li><a href="global.html#UserKeyData">UserKeyData</a></li><li><a href="global.html#UserProfile">UserProfile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Oct 25 2022 14:21:25 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
